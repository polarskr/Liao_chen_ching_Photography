<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Post</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; }
        h1 { color: #333; }
        form { background: #f4f4f4; padding: 20px; }
        input[type="text"], textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; }
        input[type="submit"] { background: #333; color: #fff; padding: 10px 15px; border: none; cursor: pointer; }
        input[type="submit"]:hover { background: #444; }
        .error-message { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Edit Post</h1>
    <select id="postSelector">
        <option value="">Select a post to edit</option>
    </select>
    <form id="editForm" style="display: none;">
        <input type="text" id="title" name="title" required>
        <textarea id="content" name="content" rows="10" required></textarea>
        <input type="submit" value="Update Post">
    </form>
    <div id="errorMessage" class="error-message"></div>
    <a href="blog.html">Back to Blog</a>

    <script>
        const postSelector = document.getElementById('postSelector');
        const editForm = document.getElementById('editForm');
        const titleInput = document.getElementById('title');
        const contentInput = document.getElementById('content');
        const errorMessage = document.getElementById('errorMessage');

        // 获取所有文章并填充选择器
        fetch('http://localhost:3000/api/posts')
            .then(response => response.json())
            .then(posts => {
                posts.forEach(post => {
                    const option = document.createElement('option');
                    option.value = post.id;
                    option.textContent = post.title;
                    postSelector.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error:', error);
                errorMessage.textContent = 'Error loading posts.';
            });

        // 当选择文章时加载文章内容
        postSelector.addEventListener('change', function() {
            const postId = this.value;
            if (postId) {
                fetch(`http://localhost:3000/api/posts/${postId}`)
                    .then(response => response.json())
                    .then(post => {
                        titleInput.value = post.title;
                        contentInput.value = post.content;
                        editForm.style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        errorMessage.textContent = 'Error loading post data.';
                    });
            } else {
                editForm.style.display = 'none';
            }
        });

        // 处理表单提交
        editForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const postId = postSelector.value;
            const updatedPost = {
                title: titleInput.value,
                content: contentInput.value
            };

            fetch(`http://localhost:3000/api/posts/${postId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedPost),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
                window.location.href = 'blog.html'; // 重定向到博客页面
            })
            .catch((error) => {
                console.error('Error:', error);
                errorMessage.textContent = 'An error occurred while updating the post. Please try again.';
            });
        });
    </script>
</body>
</html>